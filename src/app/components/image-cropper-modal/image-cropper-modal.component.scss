// /* =========================
//    Image Cropper (tokenized)
//    ========================= */

// .crop-content {
//   --padding-top: 0;
//   --padding-bottom: 0;
//   --padding-start: 0;
//   --padding-end: 0;
// }

// /* Shell */
// .crop-container {
//   padding: 16px;
//   height: 100%;
//   display: flex;
//   flex-direction: column;
//   justify-content: center;
//   align-items: center;
//   background: var(--ion-item-background);
// }

// /* Stage */
// .image-container {
//   position: relative;
//   display: flex;
//   justify-content: center;
//   align-items: center;
//   max-width: 100%;
//   max-height: 70vh;
//   background: color-mix(in srgb, var(--ion-text-color) 96%, #0000); /* deep neutral that adapts */
//   border-radius: 12px;
//   overflow: hidden;
//   border: 1px solid var(--ion-border-color);
//   box-shadow: 0 4px 16px rgba(0,0,0,.12);
// }

// /* Image */
// .crop-image {
//   max-width: 100%;
//   max-height: 70vh;
//   display: block;
//   user-select: none;
//   -webkit-user-select: none;
//   -webkit-touch-callout: none;
//   -webkit-user-drag: none;
//   pointer-events: none;
//   object-fit: contain;
// }

// /* Selection overlay */
// .crop-overlay {
//   position: absolute;
//   border: 2px solid var(--ion-color-primary);
//   background: rgba(var(--ion-color-primary-rgb), .10);
//   cursor: move;
//   min-width: 50px;
//   min-height: 50px;
//   opacity: 0;
//   transition: opacity .25s ease, box-shadow .15s ease;

//   &.visible { opacity: 1; }

//   &::before {
//     content: '';
//     position: absolute; inset: 0;
//     border: 2px dashed rgba(255,255,255,.85);
//     mix-blend-mode: overlay; /* keeps dashes visible on dark bg */
//     pointer-events: none;
//   }

//   /* Keyboard accessibility */
//   &:focus-visible {
//     outline: none;
//     box-shadow: var(--focus-ring);
//   }
// }

// /* Handles */
// .resize-handle {
//   position: absolute;
//   background: var(--ion-color-primary);
//   border: 2px solid var(--ion-color-primary-contrast, #fff);
//   cursor: pointer;
//   user-select: none;
//   touch-action: none;

//   &.corner {
//     width: 14px;
//     height: 14px;
//     border-radius: 50%;
//   }

//   /* Larger invisible hit area for touch */
//   &::after {
//     content: '';
//     position: absolute; inset: -8px;
//   }
// }

// .resize-handle.top-left    { top: -7px; left: -7px; cursor: nw-resize; }
// .resize-handle.top-right   { top: -7px; right: -7px; cursor: ne-resize; }
// .resize-handle.bottom-left { bottom: -7px; left: -7px; cursor: sw-resize; }
// .resize-handle.bottom-right{ bottom: -7px; right: -7px; cursor: se-resize; }

// /* Drag hint */
// .drag-indicator {
//   position: absolute; top: 50%; left: 50%;
//   transform: translate(-50%, -50%);
//   pointer-events: none;
//   color: color-mix(in srgb, #fff 85%, transparent);
//   opacity: 0;
//   transition: opacity .25s ease;
// }
// .crop-overlay:hover .drag-indicator { opacity: 1; }

// .drag-icon {
//   font-size: 20px;
//   filter: drop-shadow(0 1px 2px rgba(0,0,0,.3));
// }

// /* Loading mask */
// .loading-overlay {
//   position: absolute; inset: 0;
//   display: flex; flex-direction: column; justify-content: center; align-items: center;
//   background: rgba(0,0,0,.5);
//   color: #fff;
//   z-index: 10;

//   p {
//     margin-top: 12px;
//     font-size: 14px;
//     opacity: .9;
//   }
// }

// /* Instructions */
// .instructions {
//   margin-top: 16px;
//   padding: 12px 16px;
//   background: rgba(var(--ion-color-primary-rgb), .10);
//   border-radius: 10px;
//   text-align: center;
//   border: 1px solid color-mix(in srgb, var(--ion-color-primary) 28%, var(--ion-border-color));
// }
// .instruction-text {
//   margin: 0;
//   font-size: 14px;
//   color: var(--ion-color-primary);
//   display: flex; align-items: center; justify-content: center; gap: 8px;
// }
// .info-icon { font-size: 16px; }

// /* Footer bar */
// .footer-toolbar {
//   --background: var(--ion-background-color);
//   --border-style: solid;
//   --border-width: 1px 0 0 0;
//   --border-color: var(--ion-border-color);
//   padding-bottom: env(safe-area-inset-bottom, 0);
// }

// /* Footer buttons */
// .footer-buttons {
//   display: flex;
//   justify-content: space-between;
//   padding: 12px 16px;
//   width: 100%;
//   gap: 12px;
// }

// .cancel-btn,
// .ok-btn {
//   --padding-start: 16px;
//   --padding-end: 16px;
//   height: 40px;
//   font-weight: 600;
//   min-width: 100px;
//   border-radius: 10px;
// }

// .cancel-btn {
//   --background: transparent;
//   --border-color: var(--ion-color-medium);
//   --color: var(--ion-color-medium);
//   border: 1px solid var(--ion-color-medium);
// }
// .ok-btn {
//   --background: var(--ion-color-primary);
//   --background-hover: var(--ion-color-primary-shade);
//   --color: var(--ion-color-primary-contrast);
// }

// /* Responsive */
// @media (max-width: 768px) {
//   .crop-container { padding: 12px; }
//   .image-container { max-height: 60vh; }
//   .crop-image { max-height: 60vh; }

//   .resize-handle.corner { width: 16px; height: 16px; }
//   .resize-handle.top-left     { top: -9px; left: -9px; }
//   .resize-handle.top-right    { top: -9px; right: -9px; }
//   .resize-handle.bottom-left  { bottom: -9px; left: -9px; }
//   .resize-handle.bottom-right { bottom: -9px; right: -9px; }

//   .footer-buttons { padding: 8px 12px; gap: 8px; }
//   .cancel-btn, .ok-btn { min-width: 84px; font-size: 14px; }
// }

// /* High contrast preference */
// @media (prefers-contrast: more) {
//   .crop-overlay::before { border-color: #fff; }
//   .resize-handle { border-width: 3px; }
// }

// /* Dark mode */
// @media (prefers-color-scheme: dark) {
//   .crop-container { background: var(--ion-color-dark, #121212); }
//   .image-container { box-shadow: 0 8px 24px rgba(0,0,0,.35); }
//   .instructions { background: rgba(var(--ion-color-primary-rgb), .18); }
//   .loading-overlay { background: rgba(0,0,0,.7); }
// }

// /* Appear animation */
// @keyframes cropOverlayAppear {
//   from { opacity: 0; transform: scale(.94); }
//   to   { opacity: 1; transform: scale(1); }
// }
// .crop-overlay.visible { animation: cropOverlayAppear .25s ease; }


/* =========================
   Smooth Image Cropper
   ========================= */

.crop-content {
  --padding-top: 0;
  --padding-bottom: 0;
  --padding-start: 0;
  --padding-end: 0;
}

/* Shell */
.crop-container {
  padding: 16px;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: var(--ion-item-background);
}

/* Stage */
.image-container {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  max-width: 100%;
  max-height: 70vh;
  background: color-mix(in srgb, var(--ion-text-color) 96%, #0000);
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid var(--ion-border-color);
  box-shadow: 0 4px 16px rgba(0,0,0,.12);
  transition: box-shadow 0.3s ease;
  
  &:active {
    box-shadow: 0 6px 24px rgba(0,0,0,.16);
  }
}

/* Image */
.crop-image {
  max-width: 100%;
  max-height: 70vh;
  display: block;
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-user-drag: none;
  pointer-events: none;
  object-fit: contain;
}

/* Selection overlay - SMOOTH TRANSFORMS */
.crop-overlay {
  position: absolute;
  border: 2px solid var(--ion-color-primary);
  background: rgba(var(--ion-color-primary-rgb), .10);
  cursor: move;
  min-width: 50px;
  min-height: 50px;
  opacity: 0;
  
  /* GPU acceleration for smooth movement */
  will-change: transform;
  transform: translate3d(0, 0, 0);
  
  /* Smooth transitions when not dragging */
  transition: opacity .25s ease, 
              box-shadow .15s ease;

  &.visible { 
    opacity: 1;
    animation: cropOverlayAppear .3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  /* Inner dashed border */
  &::before {
    content: '';
    position: absolute; 
    inset: 0;
    border: 2px dashed rgba(255,255,255,.85);
    mix-blend-mode: overlay;
    pointer-events: none;
    transition: border-color 0.2s ease;
  }

  /* Smooth hover effect */
  &:hover {
    background: rgba(var(--ion-color-primary-rgb), .15);
    box-shadow: 0 0 0 1px rgba(var(--ion-color-primary-rgb), .3);
  }

  /* Active state */
  &:active {
    background: rgba(var(--ion-color-primary-rgb), .18);
  }

  /* Keyboard accessibility */
  &:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring, 0 0 0 3px rgba(var(--ion-color-primary-rgb), .4));
  }
}

/* Handles - ENHANCED */
.resize-handle {
  position: absolute;
  background: var(--ion-color-primary);
  border: 2px solid var(--ion-color-primary-contrast, #fff);
  cursor: pointer;
  user-select: none;
  touch-action: none;
  
  /* Smooth scaling and GPU acceleration */
  will-change: transform;
  transform: translate3d(0, 0, 0) scale(1);
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1),
              box-shadow 0.2s ease,
              background-color 0.2s ease;

  &.corner {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0,0,0,.15);
  }

  /* Hover effect */
  &:hover {
    transform: translate3d(0, 0, 0) scale(1.2);
    box-shadow: 0 3px 8px rgba(0,0,0,.25);
    background: var(--ion-color-primary-shade);
  }

  /* Active state */
  &:active {
    transform: translate3d(0, 0, 0) scale(1.1);
    box-shadow: 0 2px 6px rgba(0,0,0,.3);
  }

  /* Larger invisible hit area for touch */
  &::after {
    content: '';
    position: absolute; 
    inset: -10px;
  }
}

.resize-handle.top-left    { top: -7px; left: -7px; cursor: nw-resize; }
.resize-handle.top-right   { top: -7px; right: -7px; cursor: ne-resize; }
.resize-handle.bottom-left { bottom: -7px; left: -7px; cursor: sw-resize; }
.resize-handle.bottom-right{ bottom: -7px; right: -7px; cursor: se-resize; }

/* Drag hint - SMOOTH FADE */
.drag-indicator {
  position: absolute; 
  top: 50%; 
  left: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  color: color-mix(in srgb, #fff 85%, transparent);
  opacity: 0;
  transition: opacity .3s ease, transform .3s ease;
}

.crop-overlay:hover .drag-indicator { 
  opacity: 1;
  transform: translate(-50%, -50%) scale(1.05);
}

.drag-icon {
  font-size: 20px;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,.4));
}

/* Loading mask - SMOOTH FADE IN */
.loading-overlay {
  position: absolute; 
  inset: 0;
  display: flex; 
  flex-direction: column; 
  justify-content: center; 
  align-items: center;
  background: rgba(0,0,0,.5);
  color: #fff;
  z-index: 10;
  backdrop-filter: blur(4px);
  animation: fadeIn .3s ease;

  ion-spinner {
    --color: var(--ion-color-primary);
  }

  p {
    margin-top: 12px;
    font-size: 14px;
    opacity: .9;
    animation: fadeInUp .5s ease .2s both;
  }
}

/* Instructions - SMOOTH APPEARANCE */
.instructions {
  margin-top: 16px;
  padding: 12px 16px;
  background: rgba(var(--ion-color-primary-rgb), .10);
  border-radius: 10px;
  text-align: center;
  border: 1px solid color-mix(in srgb, var(--ion-color-primary) 28%, var(--ion-border-color));
  animation: fadeInUp .4s ease .3s both;
  transition: background-color 0.3s ease;
  
  &:hover {
    background: rgba(var(--ion-color-primary-rgb), .15);
  }
}

.instruction-text {
  margin: 0;
  font-size: 14px;
  color: var(--ion-color-primary);
  display: flex; 
  align-items: center; 
  justify-content: center; 
  gap: 8px;
}

.info-icon { 
  font-size: 16px;
  animation: pulse 2s ease-in-out infinite;
}

/* Footer bar */
.footer-toolbar {
  --background: var(--ion-background-color);
  --border-style: solid;
  --border-width: 1px 0 0 0;
  --border-color: var(--ion-border-color);
  padding-bottom: env(safe-area-inset-bottom, 0);
}

/* Footer buttons - SMOOTH INTERACTIONS */
.footer-buttons {
  display: flex;
  justify-content: space-between;
  padding: 12px 16px;
  width: 100%;
  gap: 12px;
  animation: fadeInUp .4s ease .4s both;
}

.cancel-btn,
.ok-btn {
  --padding-start: 16px;
  --padding-end: 16px;
  height: 40px;
  font-weight: 600;
  min-width: 100px;
  border-radius: 10px;
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1),
              box-shadow 0.2s ease,
              opacity 0.2s ease;
  
  &:hover:not([disabled]) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,.15);
  }
  
  &:active:not([disabled]) {
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(0,0,0,.1);
  }
  
  &[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
  }
}

.cancel-btn {
  --background: transparent;
  --border-color: var(--ion-color-medium);
  --color: var(--ion-color-medium);
  border: 1px solid var(--ion-color-medium);
  
  &:hover:not([disabled]) {
    --background: rgba(var(--ion-color-medium-rgb), .05);
    --border-color: var(--ion-color-medium-shade);
  }
}

.ok-btn {
  --background: var(--ion-color-primary);
  --background-hover: var(--ion-color-primary-shade);
  --color: var(--ion-color-primary-contrast);
  box-shadow: 0 2px 8px rgba(var(--ion-color-primary-rgb), .3);
  
  &:hover:not([disabled]) {
    box-shadow: 0 4px 16px rgba(var(--ion-color-primary-rgb), .4);
  }
}

/* Responsive */
@media (max-width: 768px) {
  .crop-container { padding: 12px; }
  .image-container { max-height: 60vh; }
  .crop-image { max-height: 60vh; }

  .resize-handle.corner { 
    width: 18px; 
    height: 18px;
    border-width: 3px;
  }
  .resize-handle.top-left     { top: -10px; left: -10px; }
  .resize-handle.top-right    { top: -10px; right: -10px; }
  .resize-handle.bottom-left  { bottom: -10px; left: -10px; }
  .resize-handle.bottom-right { bottom: -10px; right: -10px; }

  .footer-buttons { padding: 8px 12px; gap: 8px; }
  .cancel-btn, .ok-btn { min-width: 84px; font-size: 14px; }
}

/* High contrast preference */
@media (prefers-contrast: more) {
  .crop-overlay::before { border-color: #fff; border-width: 3px; }
  .resize-handle { border-width: 3px; }
}

/* Reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .crop-container { background: var(--ion-color-dark, #121212); }
  .image-container { 
    box-shadow: 0 8px 24px rgba(0,0,0,.35);
    
    &:active {
      box-shadow: 0 12px 32px rgba(0,0,0,.45);
    }
  }
  .instructions { 
    background: rgba(var(--ion-color-primary-rgb), .18);
    border-color: color-mix(in srgb, var(--ion-color-primary) 35%, var(--ion-border-color));
  }
  .loading-overlay { background: rgba(0,0,0,.7); }
}

/* Animations */
@keyframes cropOverlayAppear {
  from { 
    opacity: 0; 
    transform: scale(.95) translate3d(0, 0, 0);
  }
  to { 
    opacity: 1; 
    transform: scale(1) translate3d(0, 0, 0);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeInUp {
  from { 
    opacity: 0; 
    transform: translateY(10px);
  }
  to { 
    opacity: 1; 
    transform: translateY(0);
  }
}

@keyframes pulse {
  0%, 100% { 
    opacity: 1; 
    transform: scale(1);
  }
  50% { 
    opacity: .7; 
    transform: scale(1.05);
  }
}

.crop-overlay.visible { 
  animation: cropOverlayAppear .3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Hardware acceleration hints */
.crop-overlay,
.resize-handle {
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  perspective: 1000px;
  -webkit-perspective: 1000px;
}