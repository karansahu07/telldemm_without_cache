<ion-header [translucent]="true">
  <!-- Selection mode header -->
  <ion-toolbar *ngIf="selected.length > 0; else normalHeader">
    <ion-buttons slot="start">
      <ion-button (click)="clearSelection()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ selected.length }}</ion-title>
    <ion-buttons slot="end">
      <!-- Delete only when ONLY privates are selected -->
      <ion-button *ngIf="selectionMeta.onlyPrivates" (click)="deleteMultipleChats()">
        <!-- <ion-icon name="trash-outline"></ion-icon> -->
         <i class="fa-solid fa-trash homemainicons"></i>
      </ion-button>
      <!-- Unarchive is always available -->
      <ion-button (click)="unarchiveSelected()">
        <!-- <ion-icon name="archive-outline"></ion-icon> -->
         <i class="fa-solid fa-box-open homemainicons"></i>
      </ion-button>
      <ion-button (click)="openArchiveMenu($event)">
        <!-- <ion-icon name="ellipsis-vertical"></ion-icon> -->
         <i class="fa-solid fa-ellipsis-vertical homemainicons"></i>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Normal header -->
  <ng-template #normalHeader>
    <ion-toolbar class="telldemm">
      <ion-buttons slot="start">
        <ion-back-button (click)="onBack()"></ion-back-button>
      </ion-buttons>
      <ion-title>Archived</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="openArchiveMenu($event)">
          <i class="fa-solid fa-ellipsis-vertical homemainicons"></i>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ng-template>

  <!-- Always-visible banner -->
  <ion-toolbar class="arch-banner">
    <div class="banner-text">
      These chats stay archived when new messages are received.
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Loader skeleton -->
  <ion-list *ngIf="isLoading" aria-busy="true" aria-live="polite">
    <ion-item *ngFor="let i of [1,2,3,4,5,6,7,8,9]" class="for_top">
      <ion-avatar slot="start">
        <ion-skeleton-text
          animated
          style="width: 40px; height: 40px; border-radius: 50%"
        ></ion-skeleton-text>
      </ion-avatar>
      <ion-label>
        <h3>
          <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
        </h3>
        <p>
          <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
        </p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- Chat List -->
  <ion-list *ngIf="!isLoading">
    <ion-item
      *ngFor="let it of items"
      [class.selected]="isSelected(it)"
      (click)="onRowClick(it, $event)"
      (touchstart)="startLongPress(it)"
      (touchend)="cancelLongPress()"
      (touchmove)="cancelLongPress()"
    >
      <!-- Selection checkbox -->
      <ion-checkbox
        *ngIf="selected.length > 0"
        slot="start"
        [checked]="isSelected(it)"
        (ionChange)="toggleSelection(it, $event)"
      >
      </ion-checkbox>

      <!-- Avatar -->
      <ion-avatar
        slot="start"
        (click)="selected.length ? toggleSelection(it, $event) : null; $event.stopPropagation()"
      >
        <ng-container *ngIf="it.avatar; else initialsTpl">
          <img [src]="it.avatar" [alt]="it.title" />
        </ng-container>
        <ng-template #initialsTpl>
          <div class="avatar">{{ it.title?.charAt(0) }}</div>
        </ng-template>
      </ion-avatar>

      <ion-label>
        <p
          class="chat-message"
          style="
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 4px;
          "
        >
          {{ it.title }}
          
          <!-- Archive badge -->
          <ion-badge
            color="medium"
            style="margin-left: 4px; font-size: 10px"
          >
            Archived
          </ion-badge>
        </p>

        <!-- Message preview -->
        <p style="margin: 0; color: #666">
          <span
            style="
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;
            "
          >
            &nbsp;{{ it.lastMessage }}
          </span>
        </p>
      </ion-label>

      <div slot="end" class="chat-meta">
        <p class="time">{{ it.lastMessageAt | date: 'shortTime' }}</p>

        <ion-badge
          *ngIf="(+ (it?.unreadCount ?? 0)) > 0"
          color="danger"
          class="unread-badge"
        >
          {{ it.unreadCount }}
        </ion-badge>
      </div>
    </ion-item>

    <!-- Empty state -->
    <div *ngIf="!items.length" class="no-chats-container">
      <ion-icon name="archive-outline"></ion-icon>
      <h2>No Archived Chats</h2>
      <p>Your archived chats will appear here</p>
    </div>
  </ion-list>
</ion-content>