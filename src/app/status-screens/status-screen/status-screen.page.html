<ion-header [translucent]="true">
  <ion-toolbar class="telldemm">
    <div class="main-header">
      <ion-title>
        <h2 class="header-name" (click)="opendummy()">Updates</h2>
      </ion-title>

      <ion-buttons slot="end" class="header-icons">
        <ion-button
          (click)="presentPopover($event)"
        >
          <!-- <img src="assets/images/dots (1).svg" alt="" /> -->
          <i class="fa-solid fa-ellipsis-vertical homemainicons"></i>
        </ion-button>
      </ion-buttons>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div>
    <div class="channels-main">
      <p class="Status">Channels</p>

      <p class="Explore" (click)="goToChannels()">
        Explore Channels
        <ion-icon name="chevron-forward-outline" [class.rotate]="isRotated"></ion-icon>
      </p>
    </div>

    <!-- --- My Channels (from backend) --- -->
    <ion-list *ngIf="!isLoadingChannels">
      <ion-list-header>
        <ion-label>My Channels</ion-label>
      </ion-list-header>

      <ion-item *ngFor="let ch of myChannels" (click)="openChat(ch)">
        <ion-avatar slot="start">
          <img [src]="ch.channel_dp  || 'assets/images/user.jfif'" />
        </ion-avatar>

        <ion-label>
          <p class="chat-message">{{ ch.channel_name }}</p>
          <p class="followers">{{ (ch.followers_count ?? 0) + ' followers' }}</p>
        </ion-label>

        <div slot="end" class="chat-meta">
          <!-- My Channels actions -->
        </div>
      </ion-item>

      <ion-item *ngIf="myChannels.length === 0">
        <ion-label>You are not following any channels yet</ion-label>
      </ion-item>
    </ion-list>

    <!-- Loading -->
    <ng-container *ngIf="isLoadingChannels">
      <ion-item>
        <ion-spinner name="crescent"></ion-spinner>
        <ion-label>Loading channels...</ion-label>
      </ion-item>
    </ng-container>

    <!-- --- Public Channels --- -->
    <div style="margin-top: 12px;">
      <p class="channels">Discover Channels (Find channels to follow)</p>

      <ion-list *ngIf="!isLoadingChannels">
        <ion-item *ngFor="let ch of filteredChannels" (click)="openChat(ch)">
          <ion-avatar slot="start">
            <img [src]="ch.channel_dp || 'assets/images/user.jfif'" />
          </ion-avatar>

          <ion-label>
            <p class="chat-India">{{ ch.channel_name }}</p>
            <p class="followers">{{ (ch.followers_count ?? 0) + ' followers' }}</p>
          </ion-label>

          <div slot="end" class="chat-meta">
            <ion-button
              fill="clear"
              size="small"
              color="primary"
              (click)="onFollowClick($event, ch)"
              [disabled]="loadingChannelId === ch.channel_id">

              <span *ngIf="!isFollowing(ch)">Join Channel</span>

              <span *ngIf="isFollowing(ch)" class="following-text">
                <ion-icon name="checkmark-done-outline"></ion-icon>
                Following Channel 
              </span>

            </ion-button>
          </div>
        </ion-item>

        <ion-item *ngIf="publicChannels.length === 0">
          <ion-label>No Channels Found</ion-label>
        </ion-item>
      </ion-list>
    </div>
  </div>

  <!-- Add Channel FAB -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openAddChannelModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>

<app-footer-tabs [totalUnreadUpdates]="totalUnreadUpdates"></app-footer-tabs>
