<!-- HEADER -->
<ion-header [translucent]="true">
  <ion-toolbar class="telldemm">
    <div class="main-header">
      <ion-title>
        <h2 class="header-name" (click)="opendummy()">Updates</h2>
      </ion-title>

      <ion-buttons slot="end" class="header-icons">
        <ion-button (click)="presentPopover($event)">
          <i class="fa-solid fa-ellipsis-vertical homemainicons"></i>
        </ion-button>
      </ion-buttons>
    </div>
  </ion-toolbar>
</ion-header>

<!-- CONTENT -->
<ion-content [scrollY]="true">

  <!-- CHANNEL HEADER -->
  <div class="channels-main">
    <p class="Status">Channels</p>

    <p class="Explore" (click)="goToChannels()">
      Explore Channels
      <ion-icon
        name="chevron-forward-outline"
        [class.rotate]="isRotated">
      </ion-icon>
    </p>
  </div>

  <!-- ========================= -->
  <!-- MY CHANNELS -->
  <!-- ========================= -->

  <ion-list-header>
    <ion-label>My Channels</ion-label>
  </ion-list-header>

  <!-- ðŸ”¥ Fixed: Removed cdk-virtual-scroll-viewport, use regular *ngFor -->
  <div class="channels-list" *ngIf="myChannels.length > 0 && !isLoadingChannels">
    <ion-item
      *ngFor="let ch of myChannels; trackBy: trackByChannelId"
      (click)="openChat(ch)"
      button
      lines="none">

      <ion-avatar slot="start">
        <img
          [src]="ch.channel_dp || 'assets/images/user.jfif'"
          [alt]="ch.channel_name" />
      </ion-avatar>

      <ion-label>
        <h2 class="chat-message">{{ ch.channel_name }}</h2>
        <p class="followers">{{ (ch.followers_count ?? 0) }} followers</p>
      </ion-label>

    </ion-item>
  </div>

  <!-- Empty state -->
  <ion-item *ngIf="myChannels.length === 0 && !isLoadingChannels">
    <ion-label>You are not following any channels yet</ion-label>
  </ion-item>

  <!-- ========================= -->
  <!-- LOADING OVERLAY -->
  <!-- ========================= -->
  <ion-spinner
    class="loading-overlay"
    [class.visible]="isLoadingChannels">
  </ion-spinner>

  <!-- ========================= -->
  <!-- DISCOVER CHANNELS -->
  <!-- ========================= -->

  <p class="channels">
    Discover Channels (Find channels to follow)
  </p>

  <!-- ðŸ”¥ Fixed: Removed cdk-virtual-scroll-viewport, use regular *ngFor -->
  <div class="channels-list" *ngIf="filteredChannels.length > 0 && !isLoadingChannels">
    <ion-item
      *ngFor="let ch of filteredChannels; trackBy: trackByChannelId"
      (click)="openChat(ch)"
      button
      lines="none">

      <ion-avatar slot="start">
        <img
          [src]="ch.channel_dp || 'assets/images/user.jfif'"
          [alt]="ch.channel_name" />
      </ion-avatar>

      <ion-label>
        <h2 class="chat-India">{{ ch.channel_name }}</h2>
        <p class="followers">{{ (ch.followers_count ?? 0) }} followers</p>
      </ion-label>

      <ion-button
        slot="end"
        fill="clear"
        size="small"
        color="primary"
        (click)="onFollowClick($event, ch)"
        [disabled]="loadingChannelId === ch.channel_id">
        Join
      </ion-button>

    </ion-item>
  </div>

  <!-- Empty state -->
  <ion-item *ngIf="filteredChannels.length === 0 && !isLoadingChannels">
    <ion-label>No Channels Found</ion-label>
  </ion-item>

  <!-- ========================= -->
  <!-- ADD CHANNEL FAB -->
  <!-- ========================= -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openAddChannelModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>

<!-- FOOTER -->
<app-footer-tabs
  [totalUnreadUpdates]="totalUnreadUpdates">
</app-footer-tabs>